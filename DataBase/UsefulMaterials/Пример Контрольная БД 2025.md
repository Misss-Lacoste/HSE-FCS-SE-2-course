### **Контрольная работа (Midterm Exam)**

**Дисциплина:** Базы данных
**Продолжительность:** 90 минут

**Инструкция:**
Внимательно прочитайте описание предметной области. Выполните все 8 заданий. Ответы на задания 1 и 2 должны содержать диаграмму и SQL DDL код. Ответы на задания 3-8 должны содержать только один SQL-запрос для каждого задания.

---

### **Описание предметной области: "Фриланс-биржа"**

Вы проектируете базу данных для платформы, где заказчики могут публиковать проекты, а фрилансеры — отправлять на них свои заявки (ставки).

*   На платформе есть **Заказчики** и **Фрилансеры**. У всех пользователей есть имя и дата регистрации. У фрилансеров дополнительно есть **специализация** (например, 'Python', 'Дизайн', 'Копирайтинг') и **часовая ставка**.
*   **Заказчик** может опубликовать несколько **Проектов**. Каждый проект принадлежит ровно одному заказчику. У проекта есть название, описание, **бюджет** и **статус** ('открыт', 'в работе', 'завершен').
*   **Фрилансер** может отправить несколько **Заявок (ставок)** на разные проекты. На один проект может быть подано много заявок от разных фрилансеров. В каждой заявке фрилансер указывает предлагаемую **стоимость** выполнения проекта и предполагаемую **дату завершения**.
*   Когда заказчик выбирает фрилансера для проекта, он **принимает** одну из заявок. Статус этой заявки меняется на 'принята', а статус проекта — на 'в работе'. Все остальные заявки на этот проект автоматически получают статус 'отклонена'. Даты подачи, принятия и отклонения заявок нужно хранить.
*   После того как проект переходит в статус 'завершен', заказчик может оставить **Отзыв** о работе фрилансера по этому проекту. Отзыв содержит **рейтинг** (от 1 до 5) и текстовый комментарий.

---

### **Задания**

**Задание 1. [1 балл] Концептуальная модель**
Спроектируйте концептуальную модель (в нотации ER или UML) для описанной фриланс-биржи. Отобразите все сущности, их ключевые атрибуты и связи между ними с указанием кардинальности.

**Задание 2. [1 балл] Логическая модель**
Переведите концептуальную модель из Задания 1 в логическую. Напишите `CREATE TABLE` скрипты для всех необходимых таблиц. Используйте наиболее подходящие типы данных, определите первичные и внешние ключи, а также добавьте необходимые ограничения целостности (`NOT NULL`, `UNIQUE`, `CHECK`).

**Задание 3. [1 балл] Простая выборка с агрегацией**
Найти всех фрилансеров со специализацией 'Python', которые сделали **более 3 заявок (ставок)** в 2023 году (по дате подачи заявки). Вывести имя фрилансера и точное количество сделанных им заявок.

**Задание 4. [1 балл] Сложная фильтрация с исключением**
Найти проекты с бюджетом **выше 50,000**, на которые делали заявки **только** те фрилансеры, у которых часовая ставка **больше или равна 1500**.
*(То есть, если на проект с бюджетом > 50,000 сделал заявку хотя бы один фрилансер со ставкой < 1500, такой проект не должен попасть в выборку).*

**Задание 5. [1 балл] Отчет с группировкой**
Построить отчет, содержащий **среднее количество заявок на один проект** в разрезе специализаций фрилансеров.
*(Каждая строка отчета должна содержать два столбца: специализация и среднее количество заявок на проект от фрилансеров этой специализации).*

**Задание 6. [1 балл] Отчет с расчетами и фильтрацией по дате**
Построить отчет о количестве завершенных проектов и суммарном бюджете этих проектов за **прошлый месяц** (относительно текущей даты, по дате завершения проекта) в разбивке по специализациям фрилансеров, выполнивших эти проекты.
*(Каждая строка отчета должна содержать три столбца: специализация, количество завершенных проектов, суммарный бюджет).*

**Задание 7. [2 балла] Ранжирование**
Найти **три** самые прибыльные специализации фрилансеров. Прибыльность определяется как суммарная стоимость всех **принятых** заявок от фрилансеров данной специализации за все время. Вывести название специализации и общую сумму.

**Задание 8. [2 балла] Self-join (самосоединение)**
Найти все **пары фрилансеров**, которые подавали заявки на один и тот же проект, причем стоимость, предложенная ими в заявках на этот проект, отличалась **не более чем на 10%**. Каждая уникальная пара должна быть в результате только один раз.