# Макрос №1 : ввод числа(условие: оно должно быть положительным)
.macro INPUT_NUMBER
    input_loop:
        la a0, input_number      # Загружаем в a0 адрес строки "Hello! Enter the number..."
        li a7, 4                 # Загружаем в a7 код системного вызова для вывода строки (4 = print_string)
        ecall                    # Выполняем системный вызов - выводим приглашение на ввод
        
        li a7, 6                 # Загружаем в a7 код системного вызова для ввода float (6 = read_float)
        ecall                    # Выполняем системный вызов - читаем число, результат в fa0
        la t0, number            # Загружаем в t0 адрес переменной number из памяти
        fsw fa0, 0(t0)           # Сохраняем введенное число (из fa0) в память по адресу [t0 + 0]
        
        # Проверка на положительность
        la t0, number            # Снова загружаем адрес переменной number в t0
        flw ft0, 0(t0)           # Загружаем значение числа из памяти [t0 + 0] в регистр ft0 (дела обстоят уже с плавающей точкой)
        la t1, zero_float        # Загружаем адрес переменной zero_float (значение 0.0) в t1
        flw ft1, 0(t1)           # Загружаем значение 0.0 из памяти [t1 + 0] в регистр ft1
        flt.s t2, ft0, ft1       # Сравниваем: если ft0 < ft1 (число < 0), устанавливаем t2 = 1, иначе t2 = 0
        bnez t2, show_error      # Если t2 ≠ 0 (число отрицательное), переходим к метке show_error
        
        j end_input              # Переходим к концу макроса (число положительное)
        
    show_error:
        la a0, error             # Загружаем в a0 адрес строки с сообщением об ошибке
        li a7, 4                 # Код системного вызова для вывода строки
        ecall                    # Выводим сообщение об ошибке
        j input_loop             # Возвращаемся к началу цикла ввода для повторной попытки
        
    end_input:                   # Метка конца макроса
.end_macro

# Макрос для ввода точности
.macro INPUT_TOCHNOST
    la a0, input_tochnost        # Загружаем адрес строки "Enter the tochnost' bla-bla-bla.."
    li a7, 4                     # Код системного вызова для вывода строки
    ecall                        # Выводим приглашение для ввода точности
    
    li a7, 6                     # Код системного вызова для ввода float
    ecall                        # Читаем точность, результат в fa0
    la t0, tochnost              # Загружаем адрес переменной tochnost в t0
    fsw fa0, 0(t0)               # Сохраняем введенную точность в память по адресу [t0 + 0]
.end_macro

# Макрос для вычисления квадратного корня
.macro COMPUTE_ROOT
    # Загрузка аргументов для подпрограммы
    la t0, number                # Загружаем адрес переменной number в t0
    flw fa0, 0(t0)               # Загружаем значение числа из памяти в fa0 (первый аргумент подпрограммы)
    la t1, tochnost              # Загружаем адрес переменной tochnost в t1
    flw fa1, 0(t1)               # Загружаем значение точности из памяти в fa1 (второй аргумент подпрограммы)
    
    # Вызов подпрограммы
    jal sqrt_iterative           # Вызываем подпрограмму вычисления квадратного корня
                                 # (сохраняет адрес возврата в ra и переходит к sqrt_iterative)
    
    # Сохранение результата
    la t0, result_val            # Загружаем адрес переменной result_val в t0
    fsw fa0, 0(t0)               # Сохраняем результат вычислений (из fa0) в память по адресу [t0 + 0]
.end_macro

# Макрос для вывода результата
.macro OUTPUT_RESULT
    # Вывод сообщения
    la a0, result                # Загружаем адрес строки "Square root is: " в a0
    li a7, 4                     # Код системного вызова для вывода строки
    ecall                        # Выводим сообщение о результате
    
    # Вывод значения
    la t0, result_val            # Загружаем адрес переменной result_val в t0
    flw fa0, 0(t0)               # Загружаем вычисленный результат из памяти в fa0
    li a7, 2                     # Код системного вызова для вывода float (2 = print_float)
    ecall                        # Выводим значение квадратного корня
    
    # Вывод новой строки
    la a0, newline               # Загружаем адрес строки с символом новой строки "\n"
    li a7, 4                     # Код системного вызова для вывода строки
    ecall                        # Выводим символ новой строки для красивого форматирования
.end_macro